<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>f Cloud</title>

<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://apis.google.com/js/api.js"></script>

<style>
body{
  font-family:Arial;
  margin:0;
  background:#f4f6fb;
  text-align:center;
}
header{
  background:#111827;
  color:white;
  padding:15px;
}
button{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin:5px;
}
.primary{background:#2563eb;color:white;}
.danger{background:#dc2626;color:white;}
.card{
  background:white;
  margin:10px auto;
  padding:15px;
  width:90%;
  max-width:600px;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  text-align:left;
}
#uploadBox{
  border:2px dashed #2563eb;
  padding:25px;
  border-radius:10px;
  margin:20px auto;
  width:90%;
  max-width:500px;
}
#uploadBox.hover{background:#e0e7ff;}
.dark{
  background:#0f172a;
  color:white;
}
.dark .card{background:#1e293b;color:white;}
.dark header{background:#000;}
</style>
</head>

<body>

<header>
  <h2>ðŸš€ f Cloud</h2>
  <button onclick="toggleDark()">ðŸŒ™ Toggle Mode</button>
  <button onclick="logout()" class="danger">Logout</button>
</header>

<br>
<div id="loginBtn"></div>

<div id="adminArea" style="display:none;">
  <div id="uploadBox">
    <p>Drag & Drop Files</p>
    <input type="file" id="fileInput" multiple hidden>
    <button class="primary" onclick="fileInput.click()">Select Files</button>
  </div>
  <progress id="progressBar" value="0" max="100" style="width:90%;max-width:500px;display:none;"></progress>
</div>

<br>
<input type="text" id="search" placeholder="Search file..." onkeyup="filterFiles()">

<div id="fileList"></div>

<script>

const CLIENT_ID="616933700070-sgh79m0pe5gskbfsg57ok4fvedmg2dev.apps.googleusercontent.com";
const ADMIN_EMAIL="sadik618900@gmail.com";
const FOLDER_ID="1KHCBi0YJlQJOGS4V9P-pHnHHLpNrv_Y0";

let accessToken;
let allFiles=[];

google.accounts.id.initialize({
  client_id:CLIENT_ID,
  callback:handleLogin
});

google.accounts.id.renderButton(
  document.getElementById("loginBtn"),
  {theme:"outline",size:"large"}
);

function handleLogin(response){
  const user=JSON.parse(atob(response.credential.split('.')[1]));
  const email=user.email;

  gapi.load("client",async()=>{
    await gapi.client.init({
      discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]
    });

    const tokenClient=google.accounts.oauth2.initTokenClient({
      client_id:CLIENT_ID,
      scope:"https://www.googleapis.com/auth/drive.file",
      callback:(res)=>{
        accessToken=res.access_token;
        listFiles();
        if(email===ADMIN_EMAIL){
          document.getElementById("adminArea").style.display="block";
        }
      }
    });
    tokenClient.requestAccessToken();
  });
}

async function listFiles(){
  const res=await gapi.client.drive.files.list({
    q:`'${FOLDER_ID}' in parents and trashed=false`,
    fields:"files(id,name,size,mimeType)"
  });

  allFiles=res.result.files;
  renderFiles(allFiles);
}

function renderFiles(files){
  const container=document.getElementById("fileList");
  container.innerHTML="";
  files.forEach(file=>{
    const size=file.size?(file.size/1024).toFixed(1)+" KB":"â€”";
    container.innerHTML+=`
      <div class="card">
        <b>${file.name}</b><br>
        Size: ${size}<br><br>
        <a href="https://drive.google.com/uc?id=${file.id}&export=download" target="_blank">
          <button class="primary">Download</button>
        </a>
      </div>
    `;
  });
}

function filterFiles(){
  const text=document.getElementById("search").value.toLowerCase();
  const filtered=allFiles.filter(f=>f.name.toLowerCase().includes(text));
  renderFiles(filtered);
}

const uploadBox=document.getElementById("uploadBox");
const fileInput=document.getElementById("fileInput");
const progressBar=document.getElementById("progressBar");

uploadBox.addEventListener("dragover",e=>{
  e.preventDefault();
  uploadBox.classList.add("hover");
});
uploadBox.addEventListener("dragleave",()=>{
  uploadBox.classList.remove("hover");
});
uploadBox.addEventListener("drop",e=>{
  e.preventDefault();
  uploadBox.classList.remove("hover");
  uploadFiles(e.dataTransfer.files);
});
fileInput.addEventListener("change",()=>{
  uploadFiles(fileInput.files);
});

function uploadFiles(files){
  Array.from(files).forEach(uploadFile);
}

function uploadFile(file){
  progressBar.style.display="block";
  progressBar.value=0;

  const metadata={
    name:file.name,
    parents:[FOLDER_ID]
  };

  const form=new FormData();
  form.append("metadata",new Blob([JSON.stringify(metadata)],{type:"application/json"}));
  form.append("file",file);

  const xhr=new XMLHttpRequest();
  xhr.open("POST","https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart");
  xhr.setRequestHeader("Authorization","Bearer "+accessToken);

  xhr.upload.onprogress=e=>{
    if(e.lengthComputable){
      progressBar.value=(e.loaded/e.total)*100;
    }
  };

  xhr.onload=()=>{
    progressBar.style.display="none";
    listFiles();
  };

  xhr.send(form);
}

function toggleDark(){
  document.body.classList.toggle("dark");
}

function logout(){
  location.reload();
}

</script>
</body>
</html>
